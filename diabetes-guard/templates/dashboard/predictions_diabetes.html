{% extends 'partials/base.html' %}
{% block title %}Diabetes Patients{% endblock %}

{% block content %}
<div class="container pt-5">
  

  <h2 id="pat">Diabetes Patients</h2>

  <div class="container pt-5">
    <div class="dropdown d-inline-block mb-3">
      <button class="btn btn-primary dropdown-toggle" type="button" id="sortDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Sort By
      </button>
      <div class="dropdown-menu" aria-labelledby="sortDropdown">
        <a class="dropdown-item" href="#" onclick="sortPatients('name')">Name</a>
        <a class="dropdown-item" href="#" onclick="sortPatients('pregnancies')">Pregnancies</a>
        <a class="dropdown-item" href="#" onclick="sortPatients('glucsose')">Glucose</a>
        <a class="dropdown-item" href="#" onclick="sortPatients('blood_pressure')">Blood Pressure</a>
        <a class="dropdown-item" href="#" onclick="sortPatients('skin_thickness')">Skin Thickness</a>
        <a class="dropdown-item" href="#" onclick="sortPatients('insulin')">Insulin</a>
        <a class="dropdown-item" href="#" onclick="sortPatients('bmi')">BMI</a>
        <a class="dropdown-item" href="#" onclick="sortPatients('dpf')">DPF</a>
        <a class="dropdown-item" href="#" onclick="sortPatients('age')">Age</a>
        <a class="dropdown-item" href="#" onclick="sortPatients('outcome')">Outcome</a>
      </div>
    </div>
    
    <div class="form-group">
      <input type="text" class="form-control" id="searchInput" placeholder="Search by name or diagnosis" onkeyup="searchPatients()">
    </div>

    <table class="table table-striped table-hover">
      <thead class="table-primary-custom">
        <tr class="table-primary-custom">
          <th scope="col">Name</th>
          <th scope="col">Pregnancies</th>
          <th scope="col">Glucose</th>
          <th scope="col">Blood Pressure</th>
          <th scope="col">Skin Thickness</th>
          <th scope="col">Insulin</th>
          <th scope="col">BMI</th>
          <th scope="col">DPF</th>
          <th scope="col">Age</th>
          <th scope="col">Outcome</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody id="patients-table-body">
        {% for patient in predicted_diagnosis %}
        <tr>
          <td>{{ patient.name }}</td>
          <td>{{ patient.pregnancies }}</td>
          <td>{{ patient.glucose }}</td>
          <td>{{ patient.blood_pressure }}</td>
          <td>{{ patient.skin_thickness }}</td>
          <td>{{ patient.insulin }}</td>
          <td>{{ patient.bmi }}</td>
          <td>{{ patient.diabetes_pedigree_function }}</td>
          <td>{{ patient.age }}</td>
          <td>{{ patient.outcome }}</td>
          <td>
            <div class="d-flex justify-content-center">
              <div class="btn-group" role="group" aria-label="Patient actions">
                <a href="{% url 'edit_patient_diabetes' patient.pk %}" class="btn btn-secondary btn-sm mr-2">Edit</a>
                <a href="{% url 'delete_patient_diabetes' patient.pk %}" class="btn btn-danger btn-sm mr-2" onclick="return confirm('Are you sure you want to delete this patient?');">Delete</a>
                <form action="{% url 'archive_patient_d' patient.pk %}" method="POST">
                  {% csrf_token %}
                  <div class="d-flex justify-content-center">
                      <button type="submit" class="btn btn-primary btn-sm">Archive</button>
                  </div>
              </form>
              </div>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
<div class="fixed-bottom d-flex justify-content-center">
  <button type='button' class='btn btn-primary btn-large btn-start' onclick="window.location.href='/form-diabetes/'">Add Patient</button>
  <button type="button" id="arh" class="btn btn-primary btn-large btn-start ml-2" onclick="window.location.href='{% url 'archived_patients_d' %}'">Archived Patients</button>
</div>

<script>
  function sortPatients(sortKey) {
    const tableBody = document.getElementById("patients-table-body");
    const rows = Array.from(tableBody.getElementsByTagName("tr"));
    
    rows.sort((a, b) => {
      let aValue, bValue;
      
      if (sortKey === 'name') {
        aValue = a.getElementsByTagName("td")[0].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[0].innerText.toLowerCase();
      } else if (sortKey === 'outcome') {
        aValue = a.getElementsByTagName("td")[9].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[9].innerText.toLowerCase();
      } else if (sortKey === 'age') {
        aValue = a.getElementsByTagName("td")[8].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[8].innerText.toLowerCase();
      } else if (sortKey === 'pregnancies') {
        aValue = a.getElementsByTagName("td")[1].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[1].innerText.toLowerCase();
      } else if (sortKey === 'glucose') {
        aValue = a.getElementsByTagName("td")[2].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[2].innerText.toLowerCase();
      } else if (sortKey === 'blood_pressure') {
        aValue = a.getElementsByTagName("td")[3].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[3].innerText.toLowerCase();
      } else if (sortKey === 'skin_thickness') {
        aValue = a.getElementsByTagName("td")[4].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[4].innerText.toLowerCase();
      } else if (sortKey === 'insulin') {
        aValue = a.getElementsByTagName("td")[5].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[5].innerText.toLowerCase();
      } else if (sortKey === 'bmi') {
        aValue = a.getElementsByTagName("td")[6].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[6].innerText.toLowerCase();
      } else if (sortKey === 'dpf') {
          aValue = a.getElementsByTagName("td")[7].innerText.toLowerCase();
          bValue = b.getElementsByTagName("td")[7].innerText.toLowerCase();
    }
    
    

    
      
      if (aValue < bValue) {
        return -1;
      } else if (aValue > bValue) {
        return 1;
      }
      
      return 0;
    });
    
    tableBody.innerHTML = "";
    rows.forEach(row => tableBody.appendChild(row));
  }
  
  function searchPatients() {
    const input = document.getElementById("searchInput");
    const filter = input.value.toLowerCase();
    const tableBody = document.getElementById("patients-table-body");
    const rows = Array.from(tableBody.getElementsByTagName("tr"));
    
    rows.forEach(row => {
      const name = row.getElementsByTagName("td")[0].innerText.toLowerCase();
      const diagnosis = row.getElementsByTagName("td")[9].innerText.toLowerCase();
      
      if (name.includes(filter) || diagnosis.includes(filter)) {
        row.style.display = "";
      } else {
        row.style.display = "none";
      }
    });
  }
</script>


<style>
  .fixed-bottom button {
    background-color: rgba(42, 98, 255, 0.8);
    border-radius: 50px;
    padding: 10px 20px;
    margin-bottom: 3px;
  }
  tbody {
    color: white;
  }
  .table-hover tbody tr:hover td,
  .table-hover tbody tr:hover th {
    background-color: #90caf9;
  }

  .table {
    background-color: RGBA(24,55,98,0.2);
  
  }

  #pat {
    color: white;
    margin-left: 100px;
  }

  #searchInput{
    width: 995px;
  }

  .table-primary-custom {
    background-color: RGBA(60, 140, 249 ,0.3) !important;
    color: white;
  }

  #sortDropdown{
    margin-left:60px;
  }

  .btn-primary {
    background-color: #3C8CF9;
    padding: 5px 10px;

  }
  .btn-primary:hover {
    background: #559CFF;
    padding: 5px 10px;
     color: #fff;
    box-shadow: 0 0 5px #3C8CF9, 0 0 25px
  }
  
  .btn-danger {
    background-color: #A33B5B;
    padding: 5px 10px;

  }
  .btn-danger:hover {
    background: #CD577B;
    padding: 5px 10px;
     color: #fff;
    box-shadow: 0 0 5px #A33B5B, 0 0 25px
  }
  .btn-secondary {
    background-color: #54A376;
    padding: 5px 10px;

  }
  .btn-secondary:hover {
    background: #54A376;
    padding: 5px 10px;
     color: #fff;
    box-shadow: 0 0 5px #A2F29D, 0 0 25px
  }
  
  #arh {
    background-color: RGBA(72, 76, 90 ,0.6);
  }

</style>
{% endblock %}
