<!-- archive_di.html -->
{% extends 'partials/base.html' %}

{% block title %}Archived DI{% endblock %}

{% block content %}
<div class="container pt-5">
  <h2 id="arch-pat">Archived DI Patients</h2>
  
  <div class="container pt-5">
    <div class="dropdown d-inline-block mb-3">
      <button class="btn btn-primary dropdown-toggle" type="button" id="sortDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Sort By
      </button>
      <div class="dropdown-menu" aria-labelledby="sortDropdown">
        <a class="dropdown-item" href="#" onclick="sortPatients('name')">Name</a>
        <a class="dropdown-item" href="#" onclick="sortPatients('age')">Age</a>
        <a class="dropdown-item" href="#" onclick="sortPatients('polyuria')">Polyuria</a>
        <a class="dropdown-item" href="#" onclick="sortPatients('hypotonic_urine')">Hypotonic Urine</a>
        <a class="dropdown-item" href="#" onclick="sortPatients('thirst')">Thirst</a>
        <a class="dropdown-item" href="#" onclick="sortPatients('serum_osmolality')">Serum Osmolality</a>
        <a class="dropdown-item" href="#" onclick="sortPatients('serum_sodium')">Serum Sodium</a>
        <a class="dropdown-item" href="#" onclick="sortPatients('diagnosis')">Diagnosis</a>

      </div>
    </div>
    
    <div class="form-group">
      <input type="text" class="form-control" id="searchInput" placeholder="Search by name or diagnosis" onkeyup="searchPatients()">
    </div>
    <table class="table table-striped table-hover">
      <thead class="table-primary-custom">
        <tr class="table-primary-custom">
          <th scope="col">Name</th>
          <th scope="col">Age</th>
          <th scope="col">Polyuria</th>
          <th scope="col">Hypotonic Urine</th>
          <th scope="col">Thirst</th>
          <th scope="col">Serum Osmolality</th>
          <th scope="col">Serum Sodium</th>
          <th scope="col">Diagnosis</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody id="archived-table-body">
        {% for data in archived_diagnosis %}
        <tr>
          <td>{{ data.name }}</td>
          <td>{{ data.age }}</td>
          <td>{{ data.polyuria }}</td>
          <td>{{ data.hypotonic_urine }}</td>
          <td>{{ data.thirst }}</td>
          <td>{{ data.serum_osmolality }}</td>
          <td>{{ data.serum_sodium }}</td>
          <td>{{ data.diagnosis }}</td>
          <td>
            <form action="{% url 'unarchive_patient' data.pk %}" method="POST">
              {% csrf_token %}
              <div class="d-flex justify-content-center">
                  <button type="submit" class="btn btn-primary btn-sm">Unarchive</button>
                  <a href="{% url 'delete_patient' data.pk %}" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this patient?');">Delete</a>
              </div>
          </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<div class="fixed-bottom d-flex justify-content-center">
  <button type='button' class='btn btn-primary btn-large btn-start' onclick="window.location.href='/predictions-di/'">Back to Active Patients</button>
</div>

<script>
  function sortPatients(sortKey) {
    const tableBody = document.getElementById("archived-table-body");
    const rows = Array.from(tableBody.getElementsByTagName("tr"));
    
    rows.sort((a, b) => {
      let aValue, bValue;
      
      if (sortKey === 'name') {
        aValue = a.getElementsByTagName("td")[0].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[0].innerText.toLowerCase();
      } else if (sortKey === 'age') {
        aValue = a.getElementsByTagName("td")[1].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[1].innerText.toLowerCase();
      } else if (sortKey === 'polyuria') {
        aValue = a.getElementsByTagName("td")[2].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[2].innerText.toLowerCase();
      } else if (sortKey === 'hypotonic_urine') {
        aValue = a.getElementsByTagName("td")[3].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[3].innerText.toLowerCase();
      } else if (sortKey === 'thirst') {
        aValue = a.getElementsByTagName("td")[4].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[4].innerText.toLowerCase();
      } else if (sortKey === 'serum_osmolality') {
        aValue = a.getElementsByTagName("td")[5].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[5].innerText.toLowerCase();
      } else if (sortKey === 'serum_sodium') {
        aValue = a.getElementsByTagName("td")[6].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[6].innerText.toLowerCase();
      } else if (sortKey === 'diagnosis') {
        aValue = a.getElementsByTagName("td")[7].innerText.toLowerCase();
        bValue = b.getElementsByTagName("td")[7].innerText.toLowerCase();
      }
      
      
      if (aValue < bValue) {
        return -1;
      } else if (aValue > bValue) {
        return 1;
      }
      
      return 0;
    });
    
    tableBody.innerHTML = "";
    rows.forEach(row => tableBody.appendChild(row));
  }
  
  function searchPatients() {
    const input = document.getElementById("searchInput");
    const filter = input.value.toLowerCase();
    const tableBody = document.getElementById("archived-table-body");
    const rows = Array.from(tableBody.getElementsByTagName("tr"));
    
    rows.forEach(row => {
      const name = row.getElementsByTagName("td")[0].innerText.toLowerCase();
      const diagnosis = row.getElementsByTagName("td")[7].innerText.toLowerCase();
      
      if (name.includes(filter) || diagnosis.includes(filter)) {
        row.style.display = "";
      } else {
        row.style.display = "none";
      }
    });
  }
</script>

<style>
 
  .btn-primary {
    background-color: #3C8CF9;
    padding: 5px 10px;
    margin-right: 10px;
  }
  .btn-primary:hover {
    background: #559CFF;
    padding: 5px 10px;
    color: #fff;
    box-shadow: 0 0 5px #3C8CF9, 0 0 25px
  }
  .btn-danger {
    background-color: #A33B5B;
    padding: 5px 10px;

  }
  .btn-danger:hover {
    background: #CD577B;
    padding: 5px 10px;
     color: #fff;
    box-shadow: 0 0 5px #A33B5B, 0 0 25px

  }
    .fixed-bottom button {
      background-color: RGBA(72, 76, 90 ,0.6);
      border-radius: 50px;
      padding: 10px 20px;
      margin-bottom: 3px;
    }
    tbody{
      color: white;
    }
    .table-hover tbody tr:hover td, .table-hover tbody tr:hover th {
    background-color: RGBA(100, 113, 152,0.5);
    }
    .table {
      background-color: RGBA(24,55,98,0.2);
    }
    h2{
      color: white;
    }
    .table-primary-custom {
      background-color: RGBA(72, 76, 90 ,0.3) !important;
      color: white;
    }

    #sortDropdown{
      background-color: RGBA(72, 76, 90 ,0.6);
    }

  
</style>


{% endblock %}
